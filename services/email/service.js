const Mailgen = require('mailgen');

class EmailService {
  constructor(env, sender) {
    this.sender = sender; // DI –≤–Ω–µ–¥—Ä—è–µ–º –º–µ—Ç–æ–¥ sender –∏–∑ –¥—Ä—É–≥–∏—Ö –∫–ª–∞—Å—Å–æ–≤ —Ñ-–ª–∞ sender.js
    switch (env) {
      case 'development':
        this.link = 'https://e44e-188-163-59-119.ngrok.io';
        break;
      case 'production':
        this.link = 'link for production';
        break;
      default:
        this.link = 'http://127.0.0.1:3000';
        break;
    }
  }

  createTemplateEmail(name, verifyTokenEmail) {
    const link = this.link;
    console.log('üöÄ ~ file: service.js ~ line 38 ~ EmailService ~ createTemplateEmail ~ link', link);
    const mailGenerator = new Mailgen({
      theme: 'default',
      product: {
        name: 'Mailgen',
        link: this.link,
      },
    });

    const email = {
      body: {
        name,
        intro: "Welcome to the Contacts app! We're very excited to have you on board.",
        action: {
          instructions: 'To get started with Contacts, please click here:',
          button: {
            color: '#22BC66', // Optional action button color
            text: 'Confirm your account',
            link: `${this.link}/api/users/verify/${verifyTokenEmail}`,
          },
        },
      },
    };
    return mailGenerator.generate(email);
  }

  async sendVerifyEmail(email, name, verifyTokenEmail) {
    const emailHTML = this.createTemplateEmail(name, verifyTokenEmail);
    const msg = {
      to: email,
      subject: 'Verify your email',
      html: emailHTML,
    };
    try {
      const result = await this.sender.send(msg);
      console.log(result);
      return true;
    } catch (error) {
      console.log(error.message);
      return false;
    }
  }
}

module.exports = EmailService;

// –≠—Ç–∞ —á–∞—Å—Ç—å –∫–æ–¥–∞ –Ω–µ—á—Ç–æ –æ–±—â–µ–µ, –∑–∞ –∫–æ—Ç–æ—Ä—ã–º –º—ã –≤—Å–µ —Å–∫—Ä—ã–≤–∞–µ–º (—Ç–∏–ø–∞ —Å–¥–µ–ª–∞–µ–º —Ñ–∞—Å–∞–¥ –∏ –∑–∞ –Ω–∏–º –±—É–¥–µ–º –≤—Å–µ –ø—Ä—è—Ç–∞—Ç—å).
// –ü–∞—Ç–µ—Ä–Ω –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –§–ê–°–ê–î(FACADE)- –ü–†–û–°–¢–û–ô –ò–ù–¢–ï–†–§–ï–ô–° –ö –°–õ–û–ñ–ù–û–ô –°–ò–°–¢–ï–ú–ï
// –ö–õ–ê–°–°–û–í, –ë–ò–ë–õ–ò–û–¢–ï–ö–ò –ò–õ–ò –§–†–ï–ô–ú–í–û–†–ö–£.
//  –ø—Ä–∏ FACADE –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è –∫–ª–∞—Å—Å–∞ EmailService –Ω–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ(extended), –∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –≤ –¥—Ä—É–≥–æ–π –∫–ª–∞—Å—Å(–≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, Dependency injection, DI)
// –ù–∞—à–∞ —Ü–µ–ª—å:
// User –ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –ø–æ email and password(–≤ db —Å–æ–∑–¥–∞–µ—Ç—Å—è –µ–≥–æ –∑–∞–ø–∏—Å—å), –ø–æ—Å–ª–µ —á–µ–≥–æ –µ–≥–æ –ø—Ä–æ—Å—è—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å email(–ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å verifyTokenEmail)
// –î–ª—è —ç—Ç–æ–≥–æ –µ–º—É –Ω—É–∂–Ω–æ –∑–∞–π—Ç–∏ –Ω–∞ email –Ω–∞–π—Ç–∏ –ø–∏—Å—å–º–æ –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É "Confirm your account"(http://joxi.ru/Q2K7OpphLja092)
// –ï—Å–ª–∏ –ø–∏—Å—å–º–æ –Ω–µ –¥–æ—à–ª–æ, —Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –º–æ–∂–Ω–∞ –æ—Å—É—â–µ—Å—Ç–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—Ä–æ—Å–æ–º (POST /api/users/verify) –∏
// –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –ª—é–±–æ–π –∑–∞—Ä–µ–≥–µ—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω(isVerified: false)
// –Ω–æ —É –Ω–µ–≥–æ –µ—Å—Ç—å –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ db.

// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ –º–æ–¥—É–ª–∏–∑–∞—Ü–∏–∏
// 1) –í –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å(—Ñ–∞–π–ª) –æ–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–æ–π-—Ç–æ —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π db-–∫–æ–ª–µ–∫—Ü–∏–∏, –µ—ë —Å–µ—Ä–≤–∏—Å-–∫–æ–Ω—Ç—Ä–æ–ª—å.
// 2) –í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏ –¥–ª—è —ç—Ç–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –Ω–µ—Ç —Å–µ—Ä–≤–∏—Å–æ–≤.
// 3) –ù–æ –º—ã –º–æ–∂–µ–º –≤—ã–¥–µ–ª–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –∏ –≤–Ω–µ—à–Ω—é—é –ª–æ–≥–∏–∫—É —ç—Ç–∏—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤,
// –Ω–∞–ø—Ä.–º—ã –∑–∞–≤–æ–¥–∏–º –ª–æ–≥–∏–∫—É "–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ - –∞—É–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏" –∏ "—Å–µ—Ä–≤–∏—Å–∞ - –∞—É–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏"
//  –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ "–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä-—é–∑–µ—Ä–æ–≤"- —ç—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –≤–Ω—É—Ç—Ä–∏ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º—ã(—Ç–∞–∫ –Ω–∞–∑—ã–≤–∞—è–º–∞—è "–≤–Ω—É—Ç—Ä–µ–Ω—è—è-–ª–æ–≥–∏–∫–∞")
// –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∞—É–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å(—Ñ-–ª –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä controllers/auth.js)
//  –í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —É –Ω–∞—Å –Ω–µ—Ç, –∫–∞–∫ —Ç–∞–∫–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏(–º—ã –∏—Ö –Ω–µ –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –∏ –±–∞–Ω–∏–º).
